<div class="flex flex-col h-full">
  <!-- Header -->
  <header class="flex items-center justify-between pb-4 border-b mb-4 print:hidden">
    <div class="flex items-center">
       <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-8 h-8 text-teal-500 mr-3">
        <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 12h16.5m-16.5 3.75h16.5M3.75 19.5h16.5M5.625 4.5h12.75a1.875 1.875 0 0 1 0 3.75H5.625a1.875 1.875 0 0 1 0-3.75Z" />
      </svg>
      <div>
        <h3 class="text-2xl font-bold text-slate-800">Reporte de Citas</h3>
        <p class="text-sm text-slate-500">Seleccione un período para ver las citas programadas.</p>
      </div>
    </div>
    <button (click)="closeModal.emit()" class="p-2 rounded-full hover:bg-slate-100 transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 text-slate-500">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
        </svg>
    </button>
  </header>
  
  <div class="print:hidden">
    <div class="bg-slate-50 p-2 rounded-lg flex items-center justify-center space-x-2 mb-4">
        <button (click)="setReportPeriod('day')" [class]="getButtonClasses('day')">Hoy</button>
        <button (click)="setReportPeriod('week')" [class]="getButtonClasses('week')">Esta Semana</button>
        <button (click)="setReportPeriod('month')" [class]="getButtonClasses('month')">Este Mes</button>
        <button (click)="setReportPeriod('year')" [class]="getButtonClasses('year')">Este Año</button>
    </div>
  </div>

  <div class="flex-grow overflow-y-auto">
    <div class="print:block hidden mb-4">
      <h1 class="text-xl font-bold">Reporte de Citas - {{ reportTitle() }}</h1>
      <p class="text-sm">Generado el {{ today | date:'longDate' }}</p>
    </div>
    <table class="w-full text-sm text-left text-slate-500">
        <thead class="text-xs text-slate-700 uppercase bg-slate-100">
            <tr>
                <th scope="col" class="px-6 py-3">Fecha</th>
                <th scope="col" class="px-6 py-3">Hora</th>
                <th scope="col" class="px-6 py-3">Paciente</th>
                <th scope="col" class="px-6 py-3">Doctor</th>
                <th scope="col" class="px-6 py-3">Motivo</th>
            </tr>
        </thead>
        <tbody>
            @for (appointment of filteredAppointments(); track appointment.id) {
                <tr class="bg-white border-b hover:bg-slate-50">
                    <td class="px-6 py-4 font-medium text-slate-900">{{ appointment.date | date:'dd/MM/yyyy' }}</td>
                    <td class="px-6 py-4">{{ appointment.startTime }}</td>
                    <td class="px-6 py-4">{{ appointment.patient?.name }}</td>
                    <td class="px-6 py-4">{{ appointment.doctor?.name }}</td>
                    <td class="px-6 py-4">{{ appointment.reason }}</td>
                </tr>
            } @empty {
                <tr>
                    <td colspan="5" class="text-center p-8">
                        <div class="flex flex-col items-center">
                            <svg class="w-12 h-12 text-slate-300 mb-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M18.364 18.364A9 9 0 0 0 5.636 5.636m12.728 12.728A9 9 0 0 1 5.636 5.636m12.728 12.728L5.636 5.636" />
                            </svg>
                            <p class="text-slate-500 font-medium">No se encontraron citas para el período seleccionado.</p>
                        </div>
                    </td>
                </tr>
            }
        </tbody>
    </table>
  </div>

  <!-- Footer -->
  <footer class="flex items-center justify-between pt-4 mt-4 border-t">
    <div class="text-sm font-semibold text-slate-600">
        Total de Citas: <span class="text-teal-600 text-base">{{ filteredAppointments().length }}</span>
    </div>
    <div class="space-x-3 print:hidden">
        <button (click)="closeModal.emit()" class="px-4 py-2 bg-slate-200 text-slate-800 rounded-md hover:bg-slate-300 transition-colors">Cerrar</button>
        <button (click)="printReport()" [disabled]="!filteredAppointments().length" class="px-4 py-2 bg-teal-500 text-white rounded-md hover:bg-teal-600 transition-colors disabled:bg-slate-300 disabled:cursor-not-allowed flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 mr-2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6.72 13.829c-.24.03-.48.062-.72.096m.72-.096a42.415 42.415 0 0 1 10.56 0m-10.56 0L6.34 18m10.94-4.171c.24.03.48.062.72.096m-.72-.096L17.66 18m0 0 .229 2.523a1.125 1.125 0 0 1-1.12 1.227H7.231c-.662 0-1.18-.568-1.12-1.227L6.34 18m11.32 0z" />
            </svg>
            Imprimir
        </button>
        <button (click)="exportToPdf()" [disabled]="!filteredAppointments().length" class="px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 transition-colors disabled:bg-slate-300 disabled:cursor-not-allowed flex items-center">
           <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 mr-2">
             <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m.75 12 3 3m0 0 3-3m-3 3v-6m-1.5-9H5.625a1.875 1.875 0 0 0-1.875 1.875v17.25a1.875 1.875 0 0 0 1.875 1.875h12.75a1.875 1.875 0 0 0 1.875-1.875V10.5M8.25 9.75h2.25M8.25 12h5.25m-5.25 2.25h3" />
           </svg>
           Exportar PDF
        </button>
    </div>
  </footer>
</div>